<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Cassino do Pita —  PWA</title>
<meta name="theme-color" content="#0ff">
<link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIwAAACMCAYAAABaX0b+AAA...==">
<style>
  @font-face{font-family:'Orbitron';src:local('Arial');font-display:swap;}
  :root{
    --bg:#0a0a12; --panel:#121225; --panel2:#161633; --neon:#00fff0; --neon2:#ff00ff;
    --ok:#17d47a; --warn:#ffc400; --bad:#ff4d4d; --text:#e9f0ff; --muted:#9aa3b2;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:radial-gradient(1200px 800px at 20% -10%, #1a1a35 0%, #0a0a12 60%);}
  body{font-family:system-ui,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;color:var(--text);}

  /* Neon header */
  header{
    position:sticky; top:0; z-index:20;
    background:linear-gradient(180deg, #0b0b16 0%, rgba(11,11,22,.6) 100%);
    border-bottom:1px solid rgba(255,255,255,.06);
    backdrop-filter:saturate(140%) blur(8px);
  }
  .wrap{max-width:1180px;margin:0 auto;padding:12px 16px;}
  .brand{
    font-family:Orbitron,system-ui; letter-spacing:1px; font-weight:800;
    font-size:32px; display:flex; align-items:center; gap:10px;
    text-shadow:0 0 8px var(--neon), 0 0 18px var(--neon2);
  }
  .brand .blink{color:var(--neon); filter:drop-shadow(0 0 10px var(--neon));}
  .small{color:var(--muted);font-size:12px}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:#0d0d22;border:1px solid rgba(255,255,255,.08);font-size:12px}
  .live-dot{width:8px;height:8px;border-radius:50%;background:#ff5252;box-shadow:0 0 8px #ff5252,0 0 16px #ff5252;animation:pulse 1.2s infinite}
  @keyframes pulse{0%{transform:scale(.9)}50%{transform:scale(1.2)}100%{transform:scale(.9)}}

  /* Layout */
  .grid{display:grid;grid-template-columns:260px 1fr;gap:16px;max-width:1180px;margin:16px auto;padding:0 16px}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08);border-radius:18px;box-shadow:0 10px 40px rgba(0,0,0,.35), inset 0 0 40px rgba(0,255,255,.04)}
  .panel h3{margin:0 0 10px 0;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06);font-size:14px;text-transform:uppercase;letter-spacing:.12em;color:#a7b3ff}
  .panel .body{padding:16px}

  .btn{all:unset;display:inline-flex;align-items:center;justify-content:center;gap:8px;cursor:pointer;
       padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,#1d1d3a,#11112a);box-shadow:0 6px 18px rgba(0,0,0,.35);transition:.2s}
  .btn:hover{transform:translateY(-1px);box-shadow:0 12px 28px rgba(0,0,0,.45)}
  .btn.primary{border-color:rgba(0,255,255,.4);box-shadow:0 0 18px rgba(0,255,255,.12);background:radial-gradient(120% 120% at 50% 0%,#112233,#0b0b1e);text-shadow:0 0 8px var(--neon)}
  .btn.success{border-color:rgba(23,212,122,.4)}
  .btn.warn{border-color:rgba(255,196,0,.4)}
  .btn.danger{border-color:rgba(255,77,77,.4)}
  .btn.small{padding:6px 10px;font-size:12px;border-radius:10px}

  .stat{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .field{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
  .field input, .field select{
    width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);
    background:#0d0d22;color:var(--text);outline:none
  }

  /* Lobby cards */
  .lobby{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
  .game-card{position:relative;overflow:hidden;border-radius:18px;border:1px solid rgba(0,255,255,.1);
     background:linear-gradient(140deg, rgba(0,255,255,.06), rgba(255,0,255,.06));cursor:pointer}
  .game-card .thumb{height:120px;background:radial-gradient(400px 160px at 70% -40%, rgba(0,255,255,.22),transparent 60%), radial-gradient(240px 120px at 0% 100%, rgba(255,0,255,.22),transparent 60%), linear-gradient(180deg,#0e0e22,#0a0a18)}
  .game-card h4{margin:0;padding:12px 12px 14px;font-size:14px;letter-spacing:.08em;text-transform:uppercase}

  /* Views */
  .hidden{display:none}
  .view{display:none}
  .view.active{display:block}

  /* Scratch game */
  .scratch-wrap{display:flex;justify-content:center;align-items:center;padding:16px}
  .scratch-card{
    position:relative;width:360px;height:520px;margin:auto;
    background:linear-gradient(180deg,#181845,#0f0f2a);
    border-radius:22px;border:2px solid rgba(0,255,255,.3);
    box-shadow:0 0 24px rgba(0,255,255,.2), inset 0 0 60px rgba(255,0,255,.06);
    overflow:hidden;
  }
  .scratch-frame{
    position:absolute; inset:10px; border-radius:18px; border:2px dashed rgba(255,255,255,.1);
    box-shadow:inset 0 0 18px rgba(0,255,255,.15), 0 0 12px rgba(255,0,255,.15);
    padding:12px;
  }
  .ticket-head{
    text-align:center; padding:6px 10px 12px; font-family:Orbitron; letter-spacing:.1em;
    color:#fff; text-shadow:0 0 8px #00eaff,0 0 18px #ff00ff; font-weight:800; font-size:18px
  }
  .ticket-tier{display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:8px}
  .ticket-tier select{max-width:160px}
  .prize-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:8px}
  .cell{
    position:relative;height:74px;border-radius:12px;
    background:linear-gradient(180deg,#10102a,#0b0b1e);
    border:1px solid rgba(255,255,255,.08);
    display:flex;align-items:center;justify-content:center;overflow:hidden;
  }
  .cell .content{display:flex;align-items:center;gap:6px;font-weight:800}
  .cell .content img{width:24px;height:24px;filter:drop-shadow(0 0 6px rgba(0,255,255,.6))}
  .cell .value{font-size:16px;text-shadow:0 0 8px rgba(0,255,255,.5)}
  .cover{
    position:absolute;inset:0;background:
      repeating-linear-gradient( -45deg, #c9ccd5 0 10px, #b8bbc6 10px 20px);
    box-shadow:inset 0 0 14px rgba(0,0,0,.35); cursor:grab;
  }
  .cover:active{cursor:grabbing}
  canvas.scratch{position:absolute;inset:0}
  .ticket-footer{padding:10px 12px;display:flex;gap:8px;justify-content:space-between;align-items:center}

  .neon-title{font-family:Orbitron,system-ui;font-weight:900;font-size:28px;letter-spacing:.08em;color:#fff;text-align:center;margin:8px 0 4px;
    text-shadow:0 0 10px var(--neon), 0 0 22px var(--neon2),0 0 40px rgba(0,255,255,.35)}
  .dev{font-size:12px;text-align:center;color:#9fb3ff;margin-top:-2px}

  /* Slots, Aviator, Double minimal styles */
  .slots-wrap,.aviator-wrap,.double-wrap{display:flex;justify-content:center;align-items:center;padding:14px}
  .slots{width:560px;background:#11132a;border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:12px;box-shadow:0 0 24px rgba(255,0,255,.15)}
  .reels{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin:10px 0}
  .reel{height:156px;background:linear-gradient(180deg,#0a0a18,#111433);border-radius:12px;border:1px solid rgba(255,255,255,.08);display:flex;align-items:center;justify-content:center;font-size:34px}
  .aviator{width:560px;background:#11132a;border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:12px}
  .double{width:560px;background:#11132a;border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:12px}

  /* Auth modal */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:1000}
  .auth{width:360px;background:#11122a;border:1px solid rgba(255,255,255,.12);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.6)}
  .auth .head{padding:16px;border-bottom:1px solid rgba(255,255,255,.08);font-weight:700;text-align:center}
  .auth .body{padding:16px}
  .auth .foot{padding:12px 16px;border-top:1px solid rgba(255,255,255,.08);display:flex;justify-content:space-between}

  /* Toast/Alert modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:1500}
  .modal.show{display:flex}
  .modal .box{min-width:280px;max-width:420px;background:#0e1028;border:1px solid rgba(0,255,255,.2);border-radius:16px;box-shadow:0 0 24px rgba(0,255,255,.18), 0 20px 60px rgba(0,0,0,.6);padding:16px}
  .modal .title{font-family:Orbitron;font-size:16px;letter-spacing:.1em;margin-bottom:8px;color:#a6f7ff}
  .modal .msg{color:#dfe8ff}
  .modal .actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}

  /* Testimonials */
  .testimonials{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .testi{background:linear-gradient(180deg, rgba(255,255,255,.03), transparent);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:12px}
  .testi .name{font-weight:700;margin-bottom:4px}

  @media (max-width:980px){
    .grid{grid-template-columns:1fr}
    .lobby{grid-template-columns:repeat(2,1fr)}
    .scratch-card{transform:scale(.95)}
  }
</style>
</head>
<body>
<header>
  <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;gap:12px">
    <div>
      <div class="brand"><span class="blink">✦</span> Cassino do Pita <span class="blink">✦</span></div>
      <div class="small">Desenvolvido por Andre Pita — VENHA LUCRAR</div>
    </div>
    <div class="row">
      <div class="badge"><span class="live-dot"></span><span id="onlineCount">1.234</span> jogando agora</div>
      <div class="badge">Saldo: <strong id="balance">R$ 0,00</strong></div>
      <button class="btn small primary" id="btnInstall" title="Instalar App">➕ Instalar</button>
      <button class="btn small" id="btnLogout">Sair</button>
    </div>
  </div>
</header>

<main class="grid">
  <!-- Sidebar -->
  <aside class="panel">
    <h3>Conta</h3>
    <div class="body">
      <div class="stat"><span>Usuário</span><strong id="uiUser">—</strong></div>
      <div class="stat"><span>Saldo</span><strong id="uiBalance">R$ 0,00</strong></div>
      <div class="row" style="margin-top:10px">
        <button class="btn primary" id="openDeposit">Depositar </button>
        <button class="btn warn" id="openWithdraw">Saque </button>
      </div>
      <div class="field" style="margin-top:12px">
        <label for="promo">Código Promocional</label>
        <div class="row">
          <input id="promo" placeholder="digite o código">
          <button class="btn success small" id="applyPromo">Aplicar</button>
        </div>
        <div class="small">Use <strong>pitademo</strong> uma única vez para +R$ 100,00.</div>
      </div>
    </div>
    <h3>Novidades</h3>
    <div class="body">
      <div class="testimonials">
        <div class="testi">
          <div class="name">Marina • SP</div>
          <div>Adorei a raspadinha! consegui pagar o mercado 😄</div>
        </div>
        <div class="testi">
          <div class="name">Rafael • RJ</div>
          <div>Teve hora que não ganhei nada, mas é divertido e bonito.</div>
        </div>
        <div class="testi">
          <div class="name">Carlos • DF</div>
          <div> fiz boas rodadas nos slots. Interface 10/10.</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main -->
  <section class="panel">
    <h3>Lobby</h3>
    <div class="body">
      <div class="lobby" id="lobby">
        <div class="game-card" data-view="scratch">
          <div class="thumb"></div>
          <h4>Raspadinha Neon</h4>
        </div>
        <div class="game-card" data-view="slots">
          <div class="thumb"></div>
          <h4>Slots Simples</h4>
        </div>
        <div class="game-card" data-view="aviator">
          <div class="thumb"></div>
          <h4>Aviator </h4>
        </div>
        <div class="game-card" data-view="double">
          <div class="thumb"></div>
          <h4>Double </h4>
        </div>
      </div>

      <!-- Views -->
      <div id="view-scratch" class="view">
        <div class="neon-title">Cassino do Pita </div>
        <div class="dev">Cartela única raspável • encontre 3 iguais</div>
        <div class="scratch-wrap">
          <div class="scratch-card">
            <div class="scratch-frame">
              <div class="ticket-head">
                Escolha o valor da cartela
                <div class="ticket-tier">
                  <select id="ticketPrice">
                    <option value="2">R$ 2</option>
                    <option value="5" selected>R$ 5</option>
                    <option value="10">R$ 10</option>
                    <option value="100">R$ 100</option>
                  </select>
                  <button class="btn small primary" id="buyTicket">Comprar</button>
                </div>
              </div>

              <div id="grid" class="prize-grid">
                <!-- 9 cells -->
                <div class="cell"><div class="content"><img alt="money" class="ico"><span class="value">—</span></div></div>
                <div class="cell"><div class="content"><img alt="money" class="ico"><span class="value">—</span></div></div>
                <div class="cell"><div class="content"><img alt="money" class="ico"><span class="value">—</span></div></div>
                <div class="cell"><div class="content"><img alt="money" class="ico"><span class="value">—</span></div></div>
                <div class="cell"><div class="content"><img alt="money" class="ico"><span class="value">—</span></div></div>
                <div class="cell"><div class="content"><img alt="money" class="ico"><span class="value">—</span></div></div>
                <div class="cell"><div class="content"><img alt="money" class="ico"><span class="value">—</span></div></div>
                <div class="cell"><div class="content"><img alt="money" class="ico"><span class="value">—</span></div></div>
                <div class="cell"><div class="content"><img alt="money" class="ico"><span class="value">—</span></div></div>
              </div>

              <div style="position:relative;height:180px;margin-top:6px">
                <canvas id="scratchCanvas" class="scratch" width="340" height="170"></canvas>
                <div class="cover" id="cover"></div>
              </div>

              <div class="ticket-footer">
                <div class="small">Raspe toda a área para revelar.</div>
                <div class="row">
                  <button class="btn small" id="resetTicket">Nova Cartela</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div><!-- /view-scratch -->

      <div id="view-slots" class="view">
        <div class="neon-title">Slots Simples</div>
        <div class="slots-wrap">
          <div class="slots">
            <div class="row">
              <div class="field" style="width:140px">
                <label>Aposta</label>
                <select id="slotBet">
                  <option>1</option><option selected>2</option><option>5</option><option>10</option>
                </select>
              </div>
              <button class="btn primary" id="slotSpin">Girar</button>
            </div>
            <div class="reels" id="reels">
              <div class="reel">🍒</div><div class="reel">💎</div><div class="reel">🔔</div><div class="reel">7️⃣</div><div class="reel">🍋</div>
            </div>
            <div class="stat"><span>Resultado</span><strong id="slotResult">—</strong></div>
          </div>
        </div>
      </div>

      <div id="view-aviator" class="view">
        <div class="neon-title">Aviator </div>
        <div class="aviator-wrap">
          <div class="aviator">
            <div class="row">
              <div class="field" style="width:140px">
                <label>Aposta</label><input id="aviBet" type="number" value="2" min="1">
              </div>
              <button class="btn primary" id="aviStart">Iniciar Voo</button>
              <button class="btn success" id="aviCashout" disabled>Sacar</button>
            </div>
            <div class="stat"><span>Multiplicador</span><strong id="aviMult">1.00x</strong></div>
            <div class="stat"><span>Status</span><strong id="aviStatus">Aguardando…</strong></div>
          </div>
        </div>
      </div>

      <div id="view-double" class="view">
        <div class="neon-title">Double </div>
        <div class="double-wrap">
          <div class="double">
            <div class="row">
              <div class="field" style="width:140px">
                <label>Aposta</label><input id="dblBet" type="number" value="2" min="1">
              </div>
              <select id="dblChoice" class="field" style="width:140px">
                <option value="red">Vermelho (2x)</option>
                <option value="black">Preto (2x)</option>
                <option value="green">Verde (14x)</option>
              </select>
              <button class="btn primary" id="dblSpin">Girar</button>
            </div>
            <div class="stat"><span>Última cor</span><strong id="dblLast">—</strong></div>
          </div>
        </div>
      </div>

    </div>
  </section>
</main>

<!-- Auth Modal -->
<div id="authModal" class="overlay">
  <div class="auth">
    <div class="head">Entrar</div>
    <div class="body">
      <div class="field">
        <label>Telefone</label>
        <input id="authPhone" placeholder="ex: 11999999999" inputmode="numeric">
      </div>
      <div class="field">
        <label>Senha</label>
        <input id="authPass" type="password" placeholder="mín. 4 caracteres">
      </div>
      <div class="small">CRIE SEU USUARIO E COMECE A LUCRAR</div>
    </div>
    <div class="foot">
      <button class="btn" id="btnRegister">Criar conta</button>
      <button class="btn primary" id="btnLogin">Entrar</button>
    </div>
  </div>
</div>

<!-- Deposit Modal -->
<div id="depModal" class="modal">
  <div class="box">
    <div class="title">Depósito </div>
    <div class="msg">
      Escaneie o QR (exemplo) e depois clique em “Confirmar Depósito”. Não movimenta dinheiro real.
      <div style="display:flex;gap:12px;margin-top:10px;align-items:center">
        <canvas id="qrCanvas" width="140" height="140" style="background:#fff;border-radius:8px"></canvas>
        <div>
          <div class="small">Chave PIX (exemplo): <strong>15365092724</strong></div>
          <div class="small">Valor: <strong>R$ 100,00</strong></div>
        </div>
      </div>
    </div>
    <div class="actions">
      <button class="btn" data-close="#depModal">Fechar</button>
      <button class="btn success" id="confirmDeposit">Confirmar Depósito </button>
    </div>
  </div>
</div>

<!-- Withdraw Modal -->
<div id="wdModal" class="modal">
  <div class="box">
    <div class="title">Saque </div>
    <div class="msg">
      <div class="field"><label>Nome completo</label><input id="wdName" placeholder="Nome completo"></div>
      <div class="field"><label>Telefone</label><input id="wdPhone" placeholder="ex: 11999999999" inputmode="numeric"></div>
      <div class="field"><label>Chave Pix</label><input id="wdPix" placeholder="CPF/Telefone/Chave"></div>
      <div class="field"><label>Valor (até saldo)</label><input id="wdValue" type="number" min="1" step="1"></div>
      <div class="small">Um protocolo de saque será gerado.</div>
    </div>
    <div class="actions">
      <button class="btn" data-close="#wdModal">Cancelar</button>
      <button class="btn primary" id="confirmWithdraw">Gerar Ordem</button>
    </div>
  </div>
</div>

<!-- Alert Modal -->
<div id="alert" class="modal">
  <div class="box">
    <div class="title" id="alertTitle">Aviso</div>
    <div class="msg" id="alertMsg"></div>
    <div class="actions">
      <button class="btn primary" id="alertOk">OK</button>
    </div>
  </div>
</div>

<script>
/* =======================
   Assets base64 simples
======================= */
const ICON_MONEY = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABXUlEQVRIie2Uv0sDQRjHf7a2bV1wYJ6Q0iQ5p2b8A1CqgNQ6Gz8C0N2oJkF2HkM2sLyS1YHc0sGm5B8bQm0l1k6yqQ0oK9p3V3mH8m3xX3d0X4ySg0v3Y8H9+f3zvne5wY0b5l4F3kq8r9G2F7oC1b9g6k3cV0b0yQJd8A3gqZ9rj0H3cJxQw9fWwHcFdlv0N7E0XzV8bq7k4H2oG2gq2m0qfR6h8xVx2qZrK8i5mJwXbN2qk3o1wJb0U1m0m8JqvQ3o6bH9V3lZbqHqQz6H8G0iX2w4f3G0K8lJk9iX8s7e8qf0pP3P9CzZ5kN3b4mQKQz0wK6v6Wc0g8fF1E0xJ8WJm7I1n9tqQ3lY1o9xg5h2bTQmE1i1oIu9i1jQk8i7W9qfH5yI/3G4CzqjZCwD2J6Nwz6C0mCwqk3k3m3Q5rC8i8b8qvQJwRrSgZrjvMX0p2mLw0+o7l1JQ6Q2q1vQ4yQ6o5tC2cV1hQm9Q9wNf6yqfJQ9Q1c2q2B8uYg8g0k1+fB0HcE4Z/8Bzqz9J6q8F3gAAAABJRU5ErkJggg==";

/* =======================
   Helpers
======================= */
const $ = (q,root=document)=>root.querySelector(q);
const $$ = (q,root=document)=>Array.from(root.querySelectorAll(q));
const fmt = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
const store = {
  get(k,def){ try{ return JSON.parse(localStorage.getItem(k)) ?? def }catch{ return def }},
  set(k,v){ localStorage.setItem(k, JSON.stringify(v)) }
};
const uid = ()=>Math.random().toString(36).slice(2,10);

/* =======================
   Auth (local)
======================= */
let session = store.get('pita_session', null);
const users = store.get('pita_users', {});
function openAuth(){ $('#authModal').style.display='flex'; }
function closeAuth(){ $('#authModal').style.display='none'; }
function loginUI(){
  const u = session ? users[session] : null;
  $('#uiUser').textContent = u ? u.phone : '—';
  updateBalanceUI();
}
function updateBalanceUI(){
  const bal = getBalance();
  $('#balance').textContent = fmt(bal);
  $('#uiBalance').textContent = fmt(bal);
}
function getBalance(){
  const u = session ? users[session] : null;
  return u ? (u.balance||0) : 0;
}
function setBalance(v){
  if(!session) return;
  users[session].balance = Math.max(0, Math.floor(v));
  store.set('pita_users', users);
  updateBalanceUI();
}
function ensureAuth(){
  if(!session){ openAuth(); }
}
$('#btnRegister').onclick = ()=>{
  const phone = $('#authPhone').value.trim();
  const pass = $('#authPass').value.trim();
  if(phone.length<8 || pass.length<4) return alertBox('Erro','Telefone ou senha inválidos');
  if(Object.values(users).find(u=>u.phone===phone)) return alertBox('Erro','Telefone já cadastrado');
  const id = uid();
  users[id] = { id, phone, pass, balance:0, promoUsed:false, orders:[] };
  store.set('pita_users', users);
  session = id; store.set('pita_session', id);
  closeAuth(); loginUI(); alertBox('Bem-vindo','Conta criada com sucesso.');
}
$('#btnLogin').onclick = ()=>{
  const phone = $('#authPhone').value.trim();
  const pass = $('#authPass').value.trim();
  const id = Object.keys(users).find(id=>users[id].phone===phone && users[id].pass===pass);
  if(!id) return alertBox('Erro','Credenciais inválidas');
  session = id; store.set('pita_session', id);
  closeAuth(); loginUI(); alertBox('Olá','Login efetuado.');
}
$('#btnLogout').onclick = ()=>{ session=null; store.set('pita_session', null); openAuth(); }

/* =======================
   Online counter (fake)
======================= */
const baseOnline = 1200 + Math.floor(Math.random()*600);
setInterval(()=>{
  const jitter = Math.floor((Math.sin(Date.now()/30000)+1)*60) + Math.floor(Math.random()*20);
  $('#onlineCount').textContent = (baseOnline + jitter).toLocaleString('pt-BR');
}, 1500);

/* =======================
   Lobby navigation
======================= */
$$('.game-card').forEach(card=>{
  card.addEventListener('click', ()=>{
    $$('.view').forEach(v=>v.classList.remove('active'));
    const v = '#view-'+card.dataset.view;
    $(v).classList.add('active');
    // scroll to top of main panel
    window.scrollTo({top:0,behavior:'smooth'});
  });
});
function showLobby(){ $$('.view').forEach(v=>v.classList.remove('active')); }

/* =======================
   Promo code
======================= */
$('#applyPromo').onclick = ()=>{
  ensureAuth();
  const u = users[session];
  const code = $('#promo').value.trim().toLowerCase();
  if(code!=='pitademo') return alertBox('Ops','Código inválido.');
  if(u.promoUsed) return alertBox('Ops','O código já foi utilizado nesta conta.');
  u.promoUsed = true;
  u.balance = (u.balance||0) + 100;
  store.set('pita_users', users);
  updateBalanceUI();
  alertBox('Sucesso','Crédito de R$ 100,00 adicionado!');
}

/* =======================
   Deposit (DEMO)
======================= */
$('#openDeposit').onclick = ()=>{ ensureAuth(); openModal('#depModal'); drawQR('#qrCanvas', '00020126360014BR.GOV.BCB.PIX0111demo-pix5204000053039865406100.005802BR59206009Sao Paulo62070503***6304ABCD'); }
$('#confirmDeposit').onclick = ()=>{
  ensureAuth();
  const u = users[session];
  u.balance = (u.balance||0) + 100;
  store.set('pita_users', users);
  updateBalanceUI();
  closeModal('#depModal');
  alertBox('Depósito ','R$ 100,00 adicionados ao seu saldo.');
}

/* =======================
   Withdraw (DEMO)
======================= */
$('#openWithdraw').onclick = ()=>{ ensureAuth(); openModal('#wdModal'); $('#wdValue').max = getBalance(); }
$('#confirmWithdraw').onclick = ()=>{
  ensureAuth();
  const name = $('#wdName').value.trim();
  const phone = $('#wdPhone').value.trim();
  const pix = $('#wdPix').value.trim();
  const value = Math.floor(Number($('#wdValue').value||0));
  if(!name || !phone || !pix || value<=0) return alertBox('Erro','Preencha todos os campos corretamente.');
  if(value > getBalance()) return alertBox('Erro','Valor maior que o saldo disponível.');
  const order = { id: uid(), name, phone, pix, value, status:'Pendente (manual)', at:new Date().toISOString() };
  users[session].orders = users[session].orders || [];
  users[session].orders.push(order);
  setBalance(getBalance()-value);
  alertBox('Ordem gerada', `Protocolo: <strong>${order.id}</strong><br>Status: ${order.status}`);
  closeModal('#wdModal');
}

/* =======================
   Scratch Game Logic
======================= */
const moneyIcos = $$('#grid .ico'); moneyIcos.forEach(img=>img.src=ICON_MONEY);

let scratch = {
  bought:false, revealed:false, erased:0, ctx:null, canvas:null, cover: null, prizes:[], price:5
};

function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr; }

/* Prize tables by ticket price (bounded, no zeros) */
function prizePool(price){
  // returns array of candidate prize amounts; we will pick 9 with constraints
  let ranges = {
    2: {min:1,max:2000, bias: {low:.85, mid:.14, high:.01}},
    5: {min:1,max:5000, bias: {low:.86, mid:.13, high:.01}},
    10:{min:1,max:10000,bias: {low:.87, mid:.12, high:.01}},
    100:{min:1,max:1000000,bias:{low:.90, mid:.095, high:.005}}
  };
  const r = ranges[price]||ranges[5];
  const pool=[];
  for(let i=0;i<200;i++){
    const p = Math.random();
    if(p<r.bias.low){
      // small values, mostly below price (never zero)
      pool.push(randInt(1, Math.max(1, Math.floor(price*0.6))));
    }else if(p<r.bias.low + r.bias.mid){
      // medium values near price (can be <= price or slightly above)
      pool.push(randInt(Math.max(1, Math.floor(price*0.5)), Math.floor(price*1.2)));
    }else{
      // high (rare) but cap to protect "house" in demo (<= 2x price with ultra small chance of >2x)
      const high = Math.random()<0.1 ? Math.floor(price*3) : Math.floor(price*2);
      pool.push(randInt(Math.max(price, Math.floor(price*1.2)), Math.max(price, high)));
    }
  }
  return pool;
}

/* Generate a 3x3 board following constraints:
   - each value appears at most 3x
   - low probability of having 3 matches
   - protects house edge (demo): rarely pay > aposta
*/
function makeBoard(price){
  const pool = prizePool(price);
  const counts = new Map();
  const pick = ()=>{
    let v=pool[randInt(0,pool.length-1)];
    // prevent zeros, ensure >=1
    v = Math.max(1,v);
    const c = counts.get(v)||0;
    if(c>=3) return pick();
    counts.set(v,c+1);
    return v;
  };
  const cells=[];
  for(let i=0;i<9;i++) cells.push(pick());

  // with small chance, ensure a match of exactly 3 (win)
  const winChance = price===100 ? 0.04 : price===10 ? 0.06 : price===5 ? 0.07 : 0.08;
  let isWin = Math.random()<winChance;
  if(isWin){
    // choose a value biased to <= price (avoid large payouts)
    const safeVals = [...counts.keys()].filter(v=>(counts.get(v)<=2));
    let val = safeVals.length? safeVals[randInt(0,safeVals.length-1)] : cells[randInt(0,8)];
    val = Math.min(val, Math.floor(price*1.2)); // cap
    // place exactly 3 occurrences
    const idxs = shuffle([0,1,2,3,4,5,6,7,8]).slice(0,3);
    idxs.forEach(i=>{ cells[i]=val; });
  }else{
    // try to avoid accidental triple
    const map = new Map();
    cells.forEach(v=>map.set(v,(map.get(v)||0)+1));
    for(const [v,c] of map){
      if(c>3){ // fix over 3 just in case
        let toFix=c-3;
        for(let i=0;i<9 && toFix>0;i++){
          if(cells[i]===v){ cells[i]=pool[randInt(0,pool.length-1)]; toFix--; }
        }
      }
    }
    // reduce chance of >2
    for(const [v,c] of map){
      if(c===3 && Math.random()<0.7){
        // break one
        const idx = cells.findIndex(x=>x===v);
        cells[idx]=pool[randInt(0,pool.length-1)];
      }
    }
  }
  return cells;
}

function renderBoard(vals){
  const cells = $$('#grid .cell');
  cells.forEach((cell,i)=>{
    const v = vals[i];
    cell.querySelector('.value').textContent = 'R$ '+ v.toLocaleString('pt-BR');
  });
}

function resetTicketUI(){
  scratch.revealed=false; scratch.erased=0; scratch.bought=false;
  // reset board visuals
  renderBoard(Array(9).fill('—'));
  // reset scratch area
  const ctx = scratch.ctx; const canvas=scratch.canvas;
  ctx.globalCompositeOperation='source-over';
  ctx.fillStyle='#b8bbc6';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  drawMetalNoise(ctx, canvas.width, canvas.height);
  scratch.cover.style.display='block';
}

function drawMetalNoise(ctx,w,h){
  // light texture to simulate foil
  for(let i=0;i<400;i++){
    const x=Math.random()*w, y=Math.random()*h;
    const a=Math.random()*.6+.2;
    ctx.fillStyle=`rgba(255,255,255,${a*.06})`;
    ctx.fillRect(x,y,1,1);
  }
}

function buyTicket(){
  ensureAuth();
  if(scratch.bought && !scratch.revealed) return alertBox('Atenção','Raspe a cartela atual antes de comprar outra.');
  const price = Number($('#ticketPrice').value);
  if(getBalance()<price) return alertBox('Saldo insuficiente', 'Faça um depósito ou use o código <strong>pitademo</strong>.');
  setBalance(getBalance()-price);
  scratch.price = price;
  scratch.prizes = makeBoard(price);
  renderBoard(scratch.prizes);
  scratch.bought = true;
  resetTicketUI();
}
$('#buyTicket').onclick = buyTicket;
$('#resetTicket').onclick = ()=>{ if(scratch.bought){ resetTicketUI(); } };

/* Scratch interaction */
(function initScratch(){
  const canvas = $('#scratchCanvas'); const cover=$('#cover');
  canvas.width = canvas.clientWidth; canvas.height=canvas.clientHeight;
  const ctx = canvas.getContext('2d'); scratch.ctx=ctx; scratch.canvas=canvas; scratch.cover=cover;

  resetTicketUI();

  let drawing=false;
  const scratchAt=(x,y)=>{
    if(!scratch.bought) return;
    ctx.globalCompositeOperation='destination-out';
    ctx.beginPath(); ctx.arc(x,y,18,0,Math.PI*2); ctx.fill();
    scratch.erased++;
    // check cleared
    if(checkCleared()){
      revealResult();
    }
  };
  const getPos=(e)=>{
    const r=canvas.getBoundingClientRect();
    if(e.touches && e.touches[0]) return {x:e.touches[0].clientX-r.left, y:e.touches[0].clientY-r.top};
    return {x:e.clientX-r.left, y:e.clientY-r.top};
  };
  const down=e=>{ if(!scratch.bought) return; drawing=true; scratchAt(...Object.values(getPos(e))); e.preventDefault(); };
  const move=e=>{ if(!drawing) return; scratchAt(...Object.values(getPos(e))); e.preventDefault(); };
  const up=()=>{ drawing=false; };

  canvas.addEventListener('mousedown',down); canvas.addEventListener('mousemove',move); window.addEventListener('mouseup',up);
  canvas.addEventListener('touchstart',down,{passive:false}); canvas.addEventListener('touchmove',move,{passive:false}); window.addEventListener('touchend',up);
})();

function checkCleared(){
  // sample pixels to estimate cleared > 60%
  const {width:w,height:h}=scratch.canvas;
  const sample=80; let cleared=0;
  const data = scratch.ctx.getImageData(0,0,w,h).data;
  for(let i=0;i<sample;i++){
    const x=randInt(0,w-1), y=randInt(0,h-1);
    const idx=(y*w+x)*4 + 3; // alpha
    const a=data[idx];
    if(a<10) cleared++;
  }
  return (cleared/sample) > .6;
}

function revealResult(){
  if(scratch.revealed) return;
  scratch.revealed=true;
  scratch.cover.style.display='none';
  // compute prize: if any value appears >=3, pay that value (capped logic is already in board)
  const map = new Map();
  scratch.prizes.forEach(v=>map.set(v,(map.get(v)||0)+1));
  let winVal=0;
  for(const [v,c] of map){
    if(c>=3){ winVal=Math.max(winVal, v); }
  }
  if(winVal>0){
    setBalance(getBalance() + winVal);
    alertBox('Parabéns!','Você encontrou <strong>3 iguais</strong> e ganhou <strong>'+fmt(winVal)+'</strong>.');
  }else{
    alertBox('Não foi desta vez','Nenhuma combinação de 3 iguais. Tente novamente!');
  }
}

/* =======================
   Slots (simplificado)
======================= */
const slotSymbols=['🍒','🍋','🔔','💎','⭐','7️⃣'];
$('#slotSpin').onclick = ()=>{
  ensureAuth();
  const bet = Number($('#slotBet').value);
  if(getBalance()<bet) return alertBox('Saldo insuficiente','Aposte um valor menor ou deposite.');
  setBalance(getBalance()-bet);
  const reels = $$('#reels .reel');
  const res=[];
  reels.forEach((r,i)=>{
    r.textContent='⏳';
    setTimeout(()=>{
      const s = slotSymbols[randInt(0,slotSymbols.length-1)];
      r.textContent=s; res[i]=s;
      if(i===reels.length-1){
        // simplistic payout: 5 of a kind 5x, 4 of a kind 2x, else 0
        const counts = res.reduce((m,s)=>(m[s]=(m[s]||0)+1,m),{});
        const best = Math.max(...Object.values(counts));
        let won=0;
        if(best>=5) won=bet*5;
        else if(best===4) won=bet*2;
        $('#slotResult').textContent = won>0 ? 'Ganhou '+fmt(won) : 'Sem combinação';
        if(won>0) setBalance(getBalance()+won);
      }
    }, 200+ i*280);
  });
}

/* =======================
   Aviator (simplificado)
======================= */
let aviTimer=null, aviCrashed=false, aviMult=1.00, aviPlaying=false;
function aviReset(){
  clearInterval(aviTimer); aviTimer=null; aviCrashed=false; aviMult=1.00; aviPlaying=false;
  $('#aviMult').textContent='1.00x'; $('#aviStatus').textContent='Aguardando…'; $('#aviCashout').disabled=true;
}
$('#aviStart').onclick = ()=>{
  ensureAuth();
  const bet = Math.floor(Number($('#aviBet').value||0));
  if(bet<=0) return alertBox('Erro','Aposta inválida.');
  if(getBalance()<bet) return alertBox('Saldo insuficiente','Deposite ou reduza a aposta.');
  setBalance(getBalance()-bet);
  aviReset(); aviPlaying=true; $('#aviStatus').textContent='Voando…'; $('#aviCashout').disabled=false;
  const crashPoint = Math.max(1.05, Math.exp(Math.random()*1.6)); // biased
  aviTimer=setInterval(()=>{
    if(aviCrashed) return;
    aviMult = (aviMult + Math.random()*0.15 + 0.02);
    $('#aviMult').textContent = aviMult.toFixed(2)+'x';
    if(aviMult >= crashPoint){
      aviCrashed=true; aviPlaying=false; $('#aviStatus').textContent='Crash!'; $('#aviCashout').disabled=true; clearInterval(aviTimer);
    }
  }, 220);
  $('#aviCashout').onclick = ()=>{
    if(!aviPlaying) return;
    const won = Math.floor(bet * aviMult);
    setBalance(getBalance()+won);
    aviPlaying=false; clearInterval(aviTimer); $('#aviStatus').textContent='Sacou em '+aviMult.toFixed(2)+'x → '+fmt(won); $('#aviCashout').disabled=true;
  };
};

/* =======================
   Double (simplificado)
======================= */
$('#dblSpin').onclick = ()=>{
  ensureAuth();
  const bet = Math.floor(Number($('#dblBet').value||0));
  const pick = $('#dblChoice').value;
  if(bet<=0) return alertBox('Erro','Aposta inválida.');
  if(getBalance()<bet) return alertBox('Saldo insuficiente','Deposite ou reduza a aposta.');
  setBalance(getBalance()-bet);
  // Biased roulette: red 47%, black 47%, green 6% (house edge)
  const r=Math.random();
  let color = r<.47?'red': r<.94?'black':'green';
  $('#dblLast').textContent = color;
  let mult = color==='green'?14:2;
  const won = (pick===color)? bet*mult : 0;
  if(won>0) setBalance(getBalance()+won);
  alertBox('Resultado', `Cor: <strong>${color.toUpperCase()}</strong><br>${won>0?'Ganhou '+fmt(won):'Sem ganho'}`);
}

/* =======================
   Stylized Alert
======================= */
function alertBox(title, html){
  $('#alertTitle').textContent=title;
  $('#alertMsg').innerHTML=html;
  openModal('#alert');
}
$('#alertOk').onclick = ()=>closeModal('#alert');

/* =======================
   Modal helpers
======================= */
function openModal(sel){ $(sel).classList.add('show'); }
function closeModal(sel){ $(sel).classList.remove('show'); }
$$('[data-close]').forEach(btn=>btn.onclick=()=>closeModal(btn.getAttribute('data-close')));

/* =======================
   QR generator (mínimo)
======================= */
function drawQR(sel, text){
  // simple placeholder QR (not real encoder) – draws a pattern so não fica em branco
  const c=$(sel); const ctx=c.getContext('2d'); ctx.clearRect(0,0,c.width,c.height);
  ctx.fillStyle='#fff'; ctx.fillRect(0,0,c.width,c.height);
  ctx.fillStyle='#000';
  const seed = [...text].reduce((a,ch)=>a+ch.charCodeAt(0),0);
  const n=21; const s=Math.floor(c.width/n);
  for(let y=0;y<n;y++){
    for(let x=0;x<n;x++){
      const v = Math.sin((x+1)*(y+1)+seed)%1;
      if(v>.5) ctx.fillRect(x*s,y*s,s-1,s-1);
    }
  }
  // finder squares
  ctx.fillRect(0,0,6*s,6*s); ctx.clearRect(1*s,1*s,4*s,4*s); ctx.fillRect(2*s,2*s,2*s,2*s);
  ctx.fillRect((n-6)*s,0,6*s,6*s); ctx.clearRect((n-5)*s,1*s,4*s,4*s); ctx.fillRect((n-4)*s,2*s,2*s,2*s);
  ctx.fillRect(0,(n-6)*s,6*s,6*s); ctx.clearRect(1*s,(n-5)*s,4*s,4*s); ctx.fillRect(2*s,(n-4)*s,2*s,2*s);
}

/* =======================
   PWA inline (manifest + SW)
======================= */
(function setupPWA(){
  // Manifest via blob
  const manifest = {
    name: "Cassino do Pita — ",
    short_name: "Cassino do Pita",
    start_url: ".",
    display: "standalone",
    background_color: "#0a0a12",
    theme_color: "#00fff0",
    icons: [
      { src: document.querySelector('link[rel="apple-touch-icon"]').href, sizes:"192x192", type:"image/png" }
    ]
  };
  const blob = new Blob([JSON.stringify(manifest)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const link = document.createElement('link'); link.rel='manifest'; link.href=url; document.head.appendChild(link);

  // Service Worker inline via blob
  const swCode = `
    const CACHE='pita-demo-v1';
    self.addEventListener('install', e=>{
      e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./'])).then(()=>self.skipWaiting()));
    });
    self.addEventListener('activate', e=>{ e.waitUntil(self.clients.claim()); });
    self.addEventListener('fetch', e=>{
      e.respondWith(
        caches.match(e.request).then(r=> r || fetch(e.request).then(res=>{
          const copy = res.clone();
          caches.open(CACHE).then(c=>{ try{ c.put(e.request, copy) }catch{} });
          return res;
        }).catch(()=>caches.match('./')))
      );
    });
  `;
  const swUrl = URL.createObjectURL(new Blob([swCode],{type:'text/javascript'}));
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register(swUrl).catch(console.error);
  }

  // install prompt
  let deferred;
  window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferred=e; $('#btnInstall').style.display='inline-flex'; });
  $('#btnInstall').onclick = ()=>{ if(deferred){ deferred.prompt(); deferred=null; } };
})();

/* =======================
   Init
======================= */
if(!session){ openAuth(); } else { loginUI(); }
$('#btnInstall').style.display='none';
loginUI();
showLobby();
/* =========================================================
   Lobby Thumbs (auto-generated, no assets externos)
   Gera imagens 3D/neon para os cards: scratch, slots, aviator, double
   ========================================================= */
(function(){
  function makeCanvas(w,h){ const c=document.createElement('canvas'); c.width=w; c.height=h; return c; }
  function rr(ctx, x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
  }
  function glowText(ctx, text, x, y, size, colorOuter, colorInner){
    ctx.save();
    ctx.font = `900 ${size}px Orbitron, system-ui, sans-serif`;
    ctx.textAlign='center';
    ctx.textBaseline='middle';
    ctx.shadowBlur=22; ctx.shadowColor=colorOuter; ctx.fillStyle=colorInner;
    ctx.fillText(text, x, y);
    ctx.shadowBlur=0;
    ctx.restore();
  }
  function setThumb(selector, dataURL){
    const el = document.querySelector(selector);
    if(!el) return;
    el.style.backgroundImage = `url(${dataURL})`;
    el.style.backgroundSize = 'cover';
    el.style.backgroundPosition = 'center';
    el.style.filter = 'saturate(115%) contrast(108%)';
  }
  function bgNeon(ctx, w, h){
    const g = ctx.createLinearGradient(0,0,w,h);
    g.addColorStop(0, '#0e1028');
    g.addColorStop(1, '#070711');
    ctx.fillStyle=g; ctx.fillRect(0,0,w,h);
    const r1 = ctx.createRadialGradient(w*0.2,h*0.1,10, w*0.2,h*0.1,w*0.6);
    r1.addColorStop(0,'rgba(0,255,255,.35)');
    r1.addColorStop(1,'rgba(0,255,255,0)');
    ctx.fillStyle=r1; ctx.globalCompositeOperation='lighter'; ctx.fillRect(0,0,w,h);
    const r2 = ctx.createRadialGradient(w*0.9,h*0.9,10, w*0.9,h*0.9,w*0.7);
    r2.addColorStop(0,'rgba(255,0,255,.28)');
    r2.addColorStop(1,'rgba(255,0,255,0)');
    ctx.fillStyle=r2; ctx.fillRect(0,0,w,h);
    ctx.globalCompositeOperation='source-over';
  }

  /* ---------- SCRATCH THUMB ---------- */
  function scratchThumb(){
    const c = makeCanvas(640,320), ctx=c.getContext('2d'), w=c.width, h=c.height;
    bgNeon(ctx,w,h);

    // Cartela
    ctx.save();
    ctx.translate(w*0.5, h*0.5);
    ctx.rotate(-0.05);
    const cardW=420, cardH=240, x=-cardW/2, y=-cardH/2;
    // moldura neon
    rr(ctx, x-6, y-6, cardW+12, cardH+12, 22);
    ctx.strokeStyle='rgba(0,255,255,.55)'; ctx.lineWidth=4; ctx.shadowBlur=15; ctx.shadowColor='rgba(0,255,255,.8)';
    ctx.stroke(); ctx.shadowBlur=0;

    // corpo
    rr(ctx, x, y, cardW, cardH, 18);
    const g = ctx.createLinearGradient(x,y,x,y+cardH);
    g.addColorStop(0,'#17193f'); g.addColorStop(1,'#0e1030');
    ctx.fillStyle=g; ctx.fill();

    // título
    glowText(ctx,'RASPADINHA', 0, y+28, 30, '#00fff0', '#a6f7ff');

    // grid 3x3
    const gx = x+24, gy=y+56, gw=cardW-48, gh=cardH-94;
    const cw = (gw-16)/3, ch=(gh-16)/3;
    for(let r=0;r<3;r++){
      for(let col=0;col<3;col++){
        const cx=gx+col*(cw+8), cy=gy+r*(ch+8);
        rr(ctx, cx,cy,cw,ch,10);
        ctx.fillStyle='linear-gradient'; // placeholder
        const g2 = ctx.createLinearGradient(cx,cy,cx,cy+ch);
        g2.addColorStop(0,'#0f123a'); g2.addColorStop(1,'#0a0d28');
        ctx.fillStyle=g2; ctx.fill();
        ctx.strokeStyle='rgba(255,255,255,.08)'; ctx.lineWidth=1.2; ctx.stroke();

        // ícone moeda + valor estilizado
        // moeda
        const mx = cx+cw*0.28, my = cy+ch*0.55, rad = Math.min(cw,ch)*0.24;
        ctx.beginPath(); ctx.arc(mx,my,rad,0,Math.PI*2);
        const gold = ctx.createRadialGradient(mx-5,my-6,2, mx,my,rad);
        gold.addColorStop(0,'#ffe79a'); gold.addColorStop(1,'#caa43a');
        ctx.fillStyle=gold; ctx.fill();
        ctx.strokeStyle='rgba(0,0,0,.28)'; ctx.lineWidth=1; ctx.stroke();
        ctx.fillStyle='rgba(0,0,0,.5)'; ctx.font='bold 18px system-ui, sans-serif';
        ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText('R$', mx, my);

        // valor
        ctx.fillStyle='#cde9ff'; ctx.font='800 18px system-ui, sans-serif';
        ctx.textAlign='left'; ctx.fillText(['1','2','5','10','20','50','100','200','500'][ (r*3+col)%9 ], cx+cw*0.48, my);
      }
    }

    // área raspável ilustrativa
    const foilY = y+cardH-40, foilH=24;
    rr(ctx, x+12, foilY, cardW-24, foilH, 10);
    const foil = ctx.createLinearGradient(x,foilY,x+cardW,foilY+foilH);
    foil.addColorStop(0,'#c9ccd5'); foil.addColorStop(1,'#9ea2b3');
    ctx.fillStyle=foil; ctx.globalAlpha=.85; ctx.fill(); ctx.globalAlpha=1;
    ctx.restore();

    // texto
    glowText(ctx,'SCRATCH', w*0.14, h*0.82, 22, '#ff00ff', '#ffd6ff');

    return c.toDataURL('image/png');
  }

  /* ---------- SLOTS THUMB ---------- */
  function slotsThumb(){
    const c = makeCanvas(640,320), ctx=c.getContext('2d'), w=c.width, h=c.height;
    bgNeon(ctx,w,h);

    // máquina (3D)
    ctx.save();
    ctx.translate(w*0.5, h*0.54);
    // base
    rr(ctx,-260,-120,520,240,28);
    const body = ctx.createLinearGradient(-260,-120,-260,120);
    body.addColorStop(0,'#17193f'); body.addColorStop(1,'#0b0e2a');
    ctx.fillStyle=body; ctx.fill();
    ctx.lineWidth=3; ctx.strokeStyle='rgba(0,255,255,.35)'; ctx.shadowBlur=18; ctx.shadowColor='rgba(0,255,255,.7)'; ctx.stroke(); ctx.shadowBlur=0;

    // topo curvo
    ctx.beginPath();
    ctx.moveTo(-240,-120); ctx.quadraticCurveTo(0,-170,240,-120); ctx.lineTo(240,-90); ctx.quadraticCurveTo(0,-140,-240,-90); ctx.closePath();
    const topG = ctx.createLinearGradient(0,-170,0,-80);
    topG.addColorStop(0,'#24285d'); topG.addColorStop(1,'#12153a');
    ctx.fillStyle=topG; ctx.fill();

    // janela das bobinas
    rr(ctx,-200,-60,400,120,16);
    const winG = ctx.createLinearGradient(-200,-60,-200,60);
    winG.addColorStop(0,'#f7f8ff'); winG.addColorStop(1,'#cfd6f8');
    ctx.fillStyle=winG; ctx.fill();
    ctx.strokeStyle='rgba(0,0,0,.15)'; ctx.lineWidth=1; ctx.stroke();

    // bobinas 3 com "profundidade"
    const reels = [-120,0,120];
    const symbols = ['7','💎','🍒','⭐','🔔','🍋'];
    reels.forEach((rx,i)=>{
      // fundo da bobina
      rr(ctx, rx-60, -54, 120, 108, 12);
      const rg = ctx.createLinearGradient(rx-60,-54, rx-60,54);
      rg.addColorStop(0,'#fefefe'); rg.addColorStop(1,'#e7ecff');
      ctx.fillStyle=rg; ctx.fill();
      // separador
      ctx.strokeStyle='rgba(0,0,0,.08)'; ctx.lineWidth=2;
      ctx.beginPath(); ctx.moveTo(rx-60,-54); ctx.lineTo(rx-60,54); ctx.moveTo(rx+60,-54); ctx.lineTo(rx+60,54); ctx.stroke();

      // símbolo principal
      const s = symbols[(i*2+3)%symbols.length];
      ctx.save();
      ctx.font = (s==='7'? '900 72px system-ui':'72px "Apple Color Emoji","Segoe UI Emoji",system-ui');
      ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillStyle = '#1a1a1a';
      ctx.fillText(s, rx, 0);
      // brilho
      ctx.globalCompositeOperation='lighter';
      ctx.shadowBlur=24; ctx.shadowColor='rgba(255,0,255,.6)';
      ctx.fillStyle='rgba(255,255,255,.9)';
      ctx.fillText(s, rx, -1);
      ctx.restore();
    });

    // alavanca lateral (3D)
    ctx.save();
    ctx.translate(270,-40);
    ctx.fillStyle='#1b1f4a'; ctx.beginPath(); ctx.roundRect?.(0,0,14,120,7) || rr(ctx,0,0,14,120,7); ctx.fill();
    ctx.beginPath(); ctx.arc(7,130,22,0,Math.PI*2); ctx.fillStyle='#c94aff'; ctx.shadowBlur=20; ctx.shadowColor='#c94aff'; ctx.fill(); ctx.shadowBlur=0;
    ctx.restore();

    ctx.restore();

    glowText(ctx,'SLOTS', w*0.5, h*0.16, 40, '#00fff0', '#a6f7ff');

    return c.toDataURL('image/png');
  }

  /* ---------- AVIATOR THUMB ---------- */
  function aviatorThumb(){
    const c = makeCanvas(640,320), ctx=c.getContext('2d'), w=c.width, h=c.height;
    bgNeon(ctx,w,h);

    // grid / gráfico
    ctx.strokeStyle='rgba(255,255,255,.08)'; ctx.lineWidth=1;
    for(let i=0;i<=10;i++){ ctx.beginPath(); ctx.moveTo(60,40+i*24); ctx.lineTo(w-30,40+i*24); ctx.stroke(); }
    for(let i=0;i<=12;i++){ ctx.beginPath(); ctx.moveTo(60+i*40,40); ctx.lineTo(60+i*40,h-40); ctx.stroke(); }

    // curva de multiplicador
    ctx.beginPath(); ctx.moveTo(60,h-60);
    const midX = w*0.6, topY = h*0.28;
    ctx.bezierCurveTo(w*0.25,h*0.6, w*0.45,h*0.45, midX, topY);
    ctx.lineTo(w-40, topY-10);
    ctx.strokeStyle='#00fff0'; ctx.lineWidth=3; ctx.shadowBlur=16; ctx.shadowColor='#00fff0'; ctx.stroke(); ctx.shadowBlur=0;

    // "avião" estilizado
    ctx.save();
    ctx.translate(midX-12, topY-6);
    ctx.fillStyle='#ff2a6d';
    ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(32,6); ctx.lineTo(0,12); ctx.closePath(); ctx.fill();
    ctx.beginPath(); ctx.rect(-6,2,16,4); ctx.fill();
    ctx.restore();

    glowText(ctx,'AVIATOR', w*0.18, h*0.18, 28, '#ff00ff', '#ffd6ff');
    return c.toDataURL('image/png');
  }

  /* ---------- DOUBLE THUMB ---------- */
  function doubleThumb(){
    const c = makeCanvas(640,320), ctx=c.getContext('2d'), w=c.width, h=c.height;
    bgNeon(ctx,w,h);

    // roleta
    const cx=w*0.68, cy=h*0.52, R=96;
    // anel
    ctx.beginPath(); ctx.arc(cx,cy,R+16,0,Math.PI*2);
    ctx.strokeStyle='rgba(0,255,255,.35)'; ctx.lineWidth=6; ctx.shadowBlur=14; ctx.shadowColor='rgba(0,255,255,.7)'; ctx.stroke(); ctx.shadowBlur=0;

    // segmentos
    const segs=24; const step = Math.PI*2/segs;
    for(let i=0;i<segs;i++){
      ctx.beginPath();
      ctx.moveTo(cx,cy);
      ctx.arc(cx,cy,R,i*step,(i+1)*step);
      ctx.closePath();
      if(i===0) ctx.fillStyle='#20c05c'; else ctx.fillStyle = i%2? '#d64c4c':'#22262e';
      ctx.fill();
    }
    // ponteiro
    ctx.save();
    ctx.translate(cx, cy-R-26);
    rr(ctx,-10,-18,20,24,8);
    ctx.fillStyle='#fafafa'; ctx.fill();
    ctx.beginPath(); ctx.moveTo(0,8); ctx.lineTo(-8,22); ctx.lineTo(8,22); ctx.closePath(); ctx.fillStyle='#ffda58'; ctx.fill();
    ctx.restore();

    glowText(ctx,'DOUBLE', w*0.22, h*0.8, 34, '#00fff0', '#a6f7ff');
    return c.toDataURL('image/png');
  }

  function applyThumbs(){
    try{
      setThumb('.game-card[data-view="scratch"] .thumb', scratchThumb());
      setThumb('.game-card[data-view="slots"] .thumb',   slotsThumb());
      setThumb('.game-card[data-view="aviator"] .thumb', aviatorThumb());
      setThumb('.game-card[data-view="double"] .thumb',  doubleThumb());
    }catch(e){ console.error('thumbs error', e); }
  }

  if(document.readyState!=='loading') applyThumbs();
  else document.addEventListener('DOMContentLoaded', applyThumbs);
})();
</script>
</body>
</html>